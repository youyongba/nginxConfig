server {

#    listen 80;
    listen 443 default;
	listen [::]:443 ipv6only=on default_server;
    server_name  youyong.ba;


    #charset koi8-r;
    #access_log  /var/log/nginx/host.access.log  main;


#		proxy_pass http://127.17.152.33:8086;
#		proxy_set_header Host $host;
	
	location / {
		proxy_pass http://127.17.152.33:8087;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_redirect http:// $scheme://;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}


    #location / {
        #root /usr/share/nginx/html/ssrdemo2/out;
#        root   /usr/share/nginx/html/pwa;
#        index  index.html index.htm;
#		proxy_pass http://127.17.152.33:8188;
#		proxy_set_header Host $host;
#		proxy_set_header X-Real-IP $remote_addr;
#		proxy_redirect http:// $scheme://;
#		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	
   # }

	proxy_ssl_server_name on;
	proxy_ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
	ssl on;
	#ssl_certificate  /etc/pki/tls/certs/youyong_ba.crt;
	#ssl_certificate_key /etc/pki/tls/certs/youyong_ba.key;	

	ssl_certificate      /etc/letsencrypt/live/youyong.ba/fullchain.pem;
        ssl_certificate_key  /etc/letsencrypt/live/youyong.ba/privkey.pem;

	ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
	ssl_prefer_server_ciphers on;
	ssl_ciphers "AES128+EECDH:AES128+EDH:!aNULL";
	ssl_ecdh_curve secp384r1; # Requires nginx >= 1.1.0
	ssl_session_cache shared:SSL:10m;
	ssl_session_tickets off; # Requires nginx >= 1.5.9
	ssl_stapling on; # Requires nginx >= 1.3.7
	ssl_stapling_verify on; # Requires nginx => 1.3.7
	resolver 119.29.29.29 182.254.116.116 valid=300s;	# DNS解析
	resolver_timeout 5s;
    #add_header Public-Key-Pins 'pin-sha256="sQIkhcu1KBG673N5ZRWFo89g0Wk7LAdNNmUCBAlNVbDD"; pin-sha256="Hjp+THiEAsgnSE/6j5gg1UluH2HHdLFu94Cgzy1aXSox"; max-age=2592000; includeSubDomains';
#	add_header Strict-Transport-Security "max-age=0; includeSubDomains;";
#	add_header X-Content-Type-Options nosniff;
	#SSL证书	
	



    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;

    error_page 497  https://$host$uri?$args;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}


server {
        listen 443;

        server_name server.youyong.ba;


        location / {
# 泛域名开始配置
		#j	if ( $host ~* (.*)\.(.*)\.(.*)\.(.*) ) {
		#	set $domain $1; #获取当前的 域名前缀

#}
    access_log  /var/log/nginx/access.log  main;
                proxy_pass http://127.17.152.33:8088;
               # proxy_pass http://127.17.152.33:8088/user/$domain;

#		proxy_http_version 1.1;
#		proxy_set_header Upgrade $http_upgrade;
# 		proxy_set_header Connection "upgrade";

                #proxy_pass http://127.17.152.33:8087;
               # proxy_set_header Host $host;
               # proxy_set_header X-Real-IP $remote_addr;
               # proxy_redirect http:// $scheme://;
               # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;



        }



	ssl_certificate      /etc/letsencrypt/live/youyong.ba/fullchain.pem;
        ssl_certificate_key  /etc/letsencrypt/live/youyong.ba/privkey.pem;

	ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
	ssl_prefer_server_ciphers on;
	ssl_ciphers "AES128+EECDH:AES128+EDH:!aNULL";
	ssl_ecdh_curve secp384r1; # Requires nginx >= 1.1.0
	ssl_session_cache shared:SSL:10m;
	ssl_session_tickets off; # Requires nginx >= 1.5.9
	ssl_stapling on; # Requires nginx >= 1.3.7
	ssl_stapling_verify on; # Requires nginx => 1.3.7
	resolver 119.29.29.29 182.254.116.116 valid=300s;	# DNS解析
	resolver_timeout 5s;







}


server {
	listen 443;

	server_name toupiao.youyong.ba;

	location / {
		proxy_pass http://127.17.152.33:8086;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_redirect http:// $scheme://;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}

server {
	listen 443;

	server_name m.youyong.ba;

	location / {
		proxy_pass http://127.17.152.33:8082;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_redirect http:// $scheme://;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}




server {
	listen 443;

	server_name easy-mock.youyong.ba;

	location / {
		proxy_pass http://127.17.152.33:8080;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_redirect http:// $scheme://;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}








server {
	listen 443;

	server_name npm.youyong.ba;

	location / {

 proxy_pass https://youyong.ba:8083/;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-NginX-Proxy true;
        proxy_ssl_session_reuse off;
        proxy_set_header Host $http_host;proxy_redirect off;

	}



}



server {
	listen 443;

	server_name api.youyong.ba;

	location / {
		proxy_pass http://127.17.152.33:8081;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_redirect http:// $scheme://;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}


